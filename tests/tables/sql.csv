table,description,sql
products,各流通センターで最も売れた製品は何ですか？,"SELECT d.name AS distribution_center_name, p.name AS top_selling_product, COUNT(oi.id) AS sales_count FROM products AS p JOIN distribution_centers AS d ON p.distribution_center_id = d.id JOIN order_items AS oi ON p.id = oi.product_id GROUP BY d.name, p.name ORDER BY sales_count DESC LIMIT 10;"
products,各製品カテゴリで最も利益率が高いのはどれですか？,"SELECT p.category, SUM(oi.sale_price) - SUM(ii.cost) AS total_profit FROM order_items AS oi JOIN inventory_items AS ii ON oi.inventory_item_id = ii.id JOIN products AS p ON oi.product_id = p.id GROUP BY p.category ORDER BY total_profit DESC;"
products,複数の部署に属する製品はありますか？,"SELECT id, COUNT(DISTINCT department) AS num_departments FROM products GROUP BY id HAVING num_departments > 1;"
users,2024年に最も多くの注文をしたユーザーは誰ですか？,"SELECT u.first_name, u.last_name, COUNT(o.order_id) AS number_of_orders FROM users AS u JOIN orders AS o ON u.id = o.user_id WHERE STRFTIME(o.created_at, '%Y') = '2024' GROUP BY u.first_name, u.last_name ORDER BY number_of_orders DESC LIMIT 1;"
users,注文をキャンセルしたことのあるユーザーをトラフィックソースごとに集計してください。,"SELECT u.traffic_source, COUNT(DISTINCT u.id) AS cancelled_users FROM users AS u JOIN orders AS o ON u.id = o.user_id WHERE o.status = 'Cancelled' GROUP BY u.traffic_source ORDER BY cancelled_users DESC;"
users,各州に住むユーザーの平均年齢を教えてください。,"SELECT state, AVG(age) AS average_age FROM users GROUP BY state;"
orders,各ユーザーが注文したアイテムの総数と合計金額を教えてください。,"SELECT u.first_name, u.last_name, COUNT(oi.id) AS total_items, SUM(oi.sale_price) AS total_sales FROM users AS u JOIN orders AS o ON u.id = o.user_id JOIN order_items AS oi ON o.order_id = oi.order_id GROUP BY u.first_name, u.last_name ORDER BY total_sales DESC LIMIT 5;"
orders,注文が作成されてから出荷されるまでの平均日数を性別ごとに教えてください。,"SELECT o.gender, AVG(o.shipped_at::DATE - o.created_at::DATE) AS average_days_to_ship FROM orders AS o WHERE o.shipped_at IS NOT NULL GROUP BY o.gender;"
orders,注文が完全に完了（出荷、配達、返品なし）するまでの平均日数を求めてください。,SELECT AVG(delivered_at::DATE - shipped_at::DATE) FROM orders WHERE delivered_at IS NOT NULL AND returned_at IS NULL;
order_items,注文された各製品カテゴリの総売上はいくらですか？,"SELECT p.category, SUM(oi.sale_price) AS total_sales FROM order_items AS oi JOIN products AS p ON oi.product_id = p.id GROUP BY p.category ORDER BY total_sales DESC;"
order_items,各注文のアイテムごとの平均販売価格を計算し、注文IDで並べ替えてください。,"SELECT order_id, AVG(sale_price) AS average_sale_price FROM order_items GROUP BY order_id ORDER BY order_id;"
order_items,どの流通センターからの注文が最も多くの返品アイテムを含んでいますか？,"SELECT d.name, COUNT(oi.id) AS returned_items_count FROM order_items AS oi JOIN products AS p ON oi.product_id = p.id JOIN distribution_centers AS d ON p.distribution_center_id = d.id WHERE oi.status = 'Returned' GROUP BY d.name ORDER BY returned_items_count DESC LIMIT 1;"
inventory_items,各製品ブランドの在庫アイテムの平均コストと、それが販売されたかどうかを教えてください。,"SELECT p.brand, AVG(ii.cost) AS average_cost, SUM(CASE WHEN ii.sold_at IS NOT NULL THEN 1 ELSE 0 END) AS sold_count FROM inventory_items AS ii JOIN products AS p ON ii.product_id = p.id GROUP BY p.brand ORDER BY sold_count DESC;"
inventory_items,販売された在庫アイテムと、それらを保管していた流通センターの名前を関連付けてください。,"SELECT ii.sold_at, d.name AS distribution_center_name FROM inventory_items AS ii JOIN products AS p ON ii.product_id = p.id JOIN distribution_centers AS d ON p.distribution_center_id = d.id WHERE ii.sold_at IS NOT NULL LIMIT 10;"
inventory_items,販売された在庫アイテムの平均コストはいくらですか？,SELECT AVG(cost) FROM inventory_items WHERE sold_at IS NOT NULL;
events,各都市で最もイベント数が多いトラフィックソースは何ですか？,"SELECT city, traffic_source, COUNT(*) AS event_count FROM events GROUP BY city, traffic_source ORDER BY city, event_count DESC;"
events,各ユーザーセッションで発生したイベントの平均数は何件ですか？,"SELECT AVG(event_count) FROM (SELECT session_id, COUNT(*) AS event_count FROM events GROUP BY session_id);"
events,どのトラフィックソースからの訪問者が最も購入（orderイベント）に至っていますか？,"SELECT e.traffic_source, COUNT(DISTINCT o.user_id) AS user_count FROM events AS e JOIN orders AS o ON e.user_id = o.user_id GROUP BY e.traffic_source ORDER BY user_count DESC;"
distribution_centers,各流通センターで在庫されている製品の平均小売価格はいくらですか？,"SELECT d.name, AVG(p.retail_price) AS average_retail_price FROM distribution_centers AS d JOIN products AS p ON d.id = p.distribution_center_id GROUP BY d.name ORDER BY average_retail_price DESC;"
distribution_centers,どの流通センターが最も多様な製品カテゴリを扱っていますか？,"SELECT d.name, COUNT(DISTINCT p.category) AS unique_categories FROM distribution_centers AS d JOIN products AS p ON d.id = p.distribution_center_id GROUP BY d.name ORDER BY unique_categories DESC;"
distribution_centers,緯度が高い順に流通センターをリストアップしてください。,"SELECT name, latitude, longitude FROM distribution_centers ORDER BY latitude DESC;"